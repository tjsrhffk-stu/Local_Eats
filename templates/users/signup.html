{% extends 'base.html' %}
{% block title %}íšŒì›ê°€ì… â€” LocalEats{% endblock %}

{% block extra_css %}
<style>
  .auth-wrap {
    min-height: calc(100vh - 200px);
    display: flex; align-items: center; justify-content: center;
    padding: 40px 24px;
  }
  .auth-card {
    width: 100%; max-width: 480px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 24px; padding: 48px 40px;
    box-shadow: var(--shadow);
    animation: fadeUp 0.5s ease;
  }
  @keyframes fadeUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

  .auth-logo { text-align: center; margin-bottom: 28px; }
  .auth-logo-text { font-family: 'Playfair Display', serif; font-size: 26px; font-weight: 700; color: var(--accent); }
  .auth-logo-text span { color: var(--text); }
  .auth-title { font-size: 22px; font-weight: 700; text-align: center; margin-bottom: 6px; }
  .auth-subtitle { font-size: 14px; color: var(--text2); text-align: center; margin-bottom: 32px; }

  .form-group { margin-bottom: 16px; }
  .form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text2); margin-bottom: 7px; }
  .input-wrap { position: relative; }
  .input-wrap .icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); font-size: 16px; pointer-events: none; }
  .input-wrap input {
    width: 100%; padding: 13px 16px 13px 42px;
    background: var(--bg); border: 1.5px solid var(--border);
    border-radius: 12px; font-size: 15px; color: var(--text);
    font-family: 'DM Sans', sans-serif; outline: none; transition: all 0.2s;
  }
  .input-wrap input:focus { border-color: var(--accent); background: var(--surface); box-shadow: 0 0 0 3px rgba(212,82,26,0.08); }
  .input-wrap input.error { border-color: #EF4444; }
  .field-error { font-size: 12px; color: #EF4444; margin-top: 5px; display: flex; align-items: center; gap: 4px; }
  .field-hint { font-size: 12px; color: var(--text2); margin-top: 5px; }

  /* ë¹„ë°€ë²ˆí˜¸ ê°•ë„ */
  .pw-strength { margin-top: 8px; }
  .pw-strength-bar { height: 4px; border-radius: 2px; background: var(--border); overflow: hidden; margin-bottom: 4px; }
  .pw-strength-fill { height: 100%; border-radius: 2px; transition: all 0.3s; width: 0; }
  .pw-strength-text { font-size: 12px; color: var(--text2); }

  .toggle-pw {
    position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
    background: none; border: none; cursor: pointer; font-size: 16px; color: var(--text2); padding: 4px;
  }

  .terms {
    display: flex; align-items: flex-start; gap: 10px;
    margin: 20px 0; padding: 16px; background: var(--bg); border-radius: 12px;
    border: 1px solid var(--border);
  }
  .terms input[type="checkbox"] { accent-color: var(--accent); width: 16px; height: 16px; margin-top: 1px; flex-shrink: 0; }
  .terms label { font-size: 13px; color: var(--text2); line-height: 1.5; cursor: pointer; }
  .terms a { color: var(--accent); text-decoration: none; }

  .btn-signup {
    width: 100%; padding: 15px; background: var(--accent); color: #fff;
    border: none; border-radius: 12px; font-size: 16px; font-weight: 700;
    font-family: 'DM Sans', sans-serif; cursor: pointer; transition: all 0.2s;
  }
  .btn-signup:hover { background: var(--accent-hover); transform: translateY(-1px); box-shadow: 0 6px 20px rgba(212,82,26,0.3); }

  .auth-footer { text-align: center; margin-top: 24px; font-size: 14px; color: var(--text2); }
  .auth-footer a { color: var(--accent); text-decoration: none; font-weight: 600; }
</style>
{% endblock %}

{% block content %}
<div class="auth-wrap">
  <div class="auth-card">
    <div class="auth-logo">
      <div class="auth-logo-text">Local<span>Eats</span></div>
    </div>
    <h1 class="auth-title">í•¨ê»˜ ë§›ì§‘ì„ íƒí—˜í•´ìš”! ğŸ½ï¸</h1>
    <p class="auth-subtitle">ë¬´ë£Œë¡œ ê°€ì…í•˜ê³  ì†”ì§í•œ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”</p>

    <form method="POST" id="signupForm">
      {% csrf_token %}

      <div class="form-group">
        <label for="id_username">ì•„ì´ë””</label>
        <div class="input-wrap">
          <span class="icon">ğŸ‘¤</span>
          <input type="text" name="username" id="id_username" placeholder="ì˜ë¬¸/ìˆ«ì 4~20ì" autocomplete="username" required>
        </div>
        {% if form.username.errors %}<div class="field-error">âš ï¸ {{ form.username.errors|join:", " }}</div>{% endif %}
        <div class="field-hint">ì˜ë¬¸, ìˆ«ì, _, @ ë§Œ ì‚¬ìš© ê°€ëŠ¥í•´ìš”</div>
      </div>

      <div class="form-group">
        <label for="id_email">ì´ë©”ì¼ <span class="required">*</span></label>
        <div class="input-wrap">
          <span class="icon">ğŸ“§</span>
          <input type="email" name="email" id="id_email" placeholder="example@email.com" autocomplete="email" required>
        </div>
      </div>

      <div class="form-group">
        <label for="id_password1">ë¹„ë°€ë²ˆí˜¸</label>
        <div class="input-wrap">
          <span class="icon">ğŸ”’</span>
          <input type="password" name="password1" id="id_password1" placeholder="8ì ì´ìƒ ì…ë ¥" autocomplete="new-password" required>
          <button type="button" class="toggle-pw" onclick="togglePw('id_password1', this)">ğŸ‘ï¸</button>
        </div>
        <div class="pw-strength" id="pwStrength" style="display:none">
          <div class="pw-strength-bar"><div class="pw-strength-fill" id="pwFill"></div></div>
          <div class="pw-strength-text" id="pwText"></div>
        </div>
        {% if form.password1.errors %}<div class="field-error">âš ï¸ {{ form.password1.errors|join:", " }}</div>{% endif %}
      </div>

      <div class="form-group">
        <label for="id_password2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
        <div class="input-wrap">
          <span class="icon">ğŸ”</span>
          <input type="password" name="password2" id="id_password2" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œ ë²ˆ ë” ì…ë ¥" autocomplete="new-password" required>
          <button type="button" class="toggle-pw" onclick="togglePw('id_password2', this)">ğŸ‘ï¸</button>
        </div>
        <div id="pwMatch" style="font-size:12px;margin-top:5px;display:none"></div>
        {% if form.password2.errors %}<div class="field-error">âš ï¸ {{ form.password2.errors|join:", " }}</div>{% endif %}
      </div>

      <div class="terms">
        <input type="checkbox" id="agreeTerms" required>
        <label for="agreeTerms">
          <a href="#">ì´ìš©ì•½ê´€</a> ë° <a href="#">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a>ì— ë™ì˜í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•´ í•„ìˆ˜ë¡œ ë™ì˜í•´ì•¼ í•´ìš”.
        </label>
      </div>

      <button type="submit" class="btn-signup">ğŸ‰ íšŒì›ê°€ì… í•˜ê¸°</button>
    </form>

    <div class="auth-footer">
      ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="/users/login/">ë¡œê·¸ì¸</a>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function togglePw(id, btn) {
  const input = document.getElementById(id);
  input.type = input.type === 'password' ? 'text' : 'password';
  btn.textContent = input.type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
}

// ë¹„ë°€ë²ˆí˜¸ ê°•ë„
document.getElementById('id_password1').addEventListener('input', function() {
  const val = this.value;
  const strength = document.getElementById('pwStrength');
  const fill = document.getElementById('pwFill');
  const text = document.getElementById('pwText');
  if (!val) { strength.style.display = 'none'; return; }
  strength.style.display = 'block';
  let score = 0;
  if (val.length >= 8) score++;
  if (/[A-Z]/.test(val)) score++;
  if (/[0-9]/.test(val)) score++;
  if (/[^A-Za-z0-9]/.test(val)) score++;
  const levels = [
    { w: '25%', color: '#EF4444', label: 'ë„ˆë¬´ ì§§ì•„ìš”' },
    { w: '50%', color: '#F59E0B', label: 'ë³´í†µì´ì—ìš”' },
    { w: '75%', color: '#3B82F6', label: 'ì¢‹ì•„ìš”!' },
    { w: '100%', color: '#10B981', label: 'ë§¤ìš° ì•ˆì „í•´ìš” ğŸ”’' },
  ];
  const l = levels[Math.max(0, score - 1)];
  fill.style.width = l.w; fill.style.background = l.color;
  text.textContent = l.label; text.style.color = l.color;
});

// ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸
document.getElementById('id_password2').addEventListener('input', function() {
  const pw1 = document.getElementById('id_password1').value;
  const match = document.getElementById('pwMatch');
  match.style.display = 'block';
  if (this.value === pw1) {
    match.textContent = 'âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•´ìš”'; match.style.color = '#10B981';
  } else {
    match.textContent = 'âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ë‹¤ë¦…ë‹ˆë‹¤'; match.style.color = '#EF4444';
  }
});
</script>
{% endblock %}